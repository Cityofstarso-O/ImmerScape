<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue & Vuetify Canvas App</title>
    
    <!-- Vuetify CSS -->
    <link href="https://cdn.jsdelivr.net/npm/vuetify@3.x/dist/vuetify.min.css" rel="stylesheet">
    <!-- Material Design Icons -->
    <link href="https://cdn.jsdelivr.net/npm/@mdi/font@7.x/css/materialdesignicons.min.css" rel="stylesheet">
    
    <style>
        /* 确保html, body, 和 v-app 占满整个视口高度 */
        html, body, #app, .v-application {
            height: 100%;
            margin: 0;
            padding: 0;
            overflow: hidden; /* 防止出现滚动条 */
        }
        /* 主布局容器 */
        .main-layout {
            display: flex;
            height: 100%; /* 因为没有 app-bar，所以高度是 100% */
        }
        /* Canvas 的容器 */
        .canvas-container {
            position: relative; /* 使得内部的绝对定位元素相对于它定位 */
            height: 100%;
            padding: 0 !important;
            /* 添加过渡效果，使 Canvas 缩放更平滑 */
            transition: width 0.2s ease-in-out;
        }
        #drop-zone {
            width: 100%;
            height: 100%;
            display: block;
            background-color: #f0f0f0;
            z-index: 0;
        }
        /* 右侧面板 */
        .scene-panel {
            flex-shrink: 0; /* 防止面板被压缩 */
            border-left: 1px solid #e0e0e0;
            display: flex;
            flex-direction: column;
        }
        .fps-counter {
            position: absolute;
            top: 16px;
            right: 16px;
            color: white;
            font-size: 16px;
            font-family: monospace;
            background-color: rgba(0, 0, 0, 0.5); /* 半透明背景，增强可读性 */
            padding: 4px 8px;
            border-radius: 4px;
            z-index: 10; /* 确保在所有元素之上 */
            pointer-events: none; /* 让鼠标可以“穿透”它，操作下面的canvas */
        }
        /* 用于 pointerLock 的遮罩层 */
        #blocker {
            position: absolute;
            width: 50%;
            height: 50%;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            border: 3px solid #ffffff;
            border-radius: 15px;
            box-sizing: border-box;
            background-color: rgba(0,0,0,0.5);
            z-index: 5; /* 在 Canvas 之上，UI 之下 */
        }
        #instructions {
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-size: 14px;
            cursor: pointer;
            color: white;
            font-family: sans-serif;
        }
        .instructions-card {
            /* 使用 RGBA 设置带透明度的背景色 */
            background-color: rgba(30, 30, 30, 0.8) !important;
            /* 可选：添加背景模糊（毛玻璃效果），增加高级感 */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #F5F5F5;
        }
        /* 为子标题设置更亮的颜色以提高对比度 */
        .v-list-subheader {
            color: rgba(245, 245, 245, 0.85);
        }
        /* 为对话框卡片添加样式 */
        .dialog-card {
            background-color: rgba(30, 30, 30, 0.85) !important;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            color: #F5F5F5;
        }
        /* 移除统计列表的内边距，让栅格系统来控制 */
        .stat-list .v-list-item {
            padding-inline-start: 0;
            padding-inline-end: 0;
        }
        /* 【新增】统计信息面板的容器样式 */
        .statistics-panel {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            width: calc(100% - 32px); /* 宽度为100%减去两边边距 */
            max-width: 900px;
            z-index: 10;
            pointer-events: none; /* 允许点击穿透容器 */
        }
        .statistics-panel > .v-card {
            pointer-events: auto; /* 但卡片本身可以响应点击 */
        }
        /* 为场景列表添加固定高度和边框 */
        .scrollable-list-container {
            padding: 8px;
        }
        .scrollable-list {
            height: 250px; /* 固定高度 */
            overflow-y: auto;
            flex-shrink: 1;
            border: 1px solid rgba(128, 128, 128, 0.3); /* 添加边框 */
            border-radius: 4px;
        }
        /* 变换面板样式 */
        .transform-panel {
            border-top: 1px solid rgba(128, 128, 128, 0.3);
            flex-shrink: 0;
        }
        .transform-row-label {
            font-size: 0.8rem;
            color: #888;
            white-space: nowrap;
            padding-right: 8px;
        }
        .draggable-label {
            cursor: ew-resize;
            user-select: none;
            padding: 0 8px;
            color: #888;
        }
        /* 【新增】分隔条样式 */
        .splitter {
            width: 5px;
            background-color: #e0e0e0;
            cursor: col-resize;
            flex-shrink: 0;
        }
        .splitter:hover {
            background-color: #bdbdbd;
        }
    </style>
</head>
<body>

<div id="app">
    <v-app>
        <!-- 左上角浮动菜单按钮 -->
        <v-menu v-model="menu" location="bottom">
            <template v-slot:activator="{ props }">
                <v-btn
                    v-bind="props"
                    icon="mdi-dots-vertical"
                    location="top start"
                    position="fixed"
                    size="large"
                    class="ma-4"
                    elevation="8"
                    style="z-index: 10;"
                ></v-btn>
            </template>
            <v-list>
                <v-list-item @click="toggleSceneManager" title="Scenes"></v-list-item>
                <v-list-item @click="toggleFPS" prepend-icon="mdi-speedometer" title="FPS"></v-list-item>
                <v-list-item @click="toggleImport" prepend-icon="mdi-file-import" title="Import"></v-list-item>
                <v-list-group value="Controls" v-if="!isMobile">
                    <template v-slot:activator="{ props }">
                        <v-list-item v-bind="props" @click.stop prepend-icon="mdi-gamepad-variant" title="Controls"></v-list-item>
                    </template>
                    <v-list-item @click="toggleControls('orbit')" title="轨道控制">
                        <template v-slot:append><v-icon v-if="controlMode === 'orbit'">mdi-check</v-icon></template>
                    </v-list-item>
                    <v-list-item @click="toggleControls('pointerLock')" title="第一人称">
                        <template v-slot:append><v-icon v-if="controlMode === 'pointerLock'">mdi-check</v-icon></template>
                    </v-list-item>
                    <v-list-item @click="toggleControls('fly')" title="飞行模式">
                        <template v-slot:append><v-icon v-if="controlMode === 'fly'">mdi-check</v-icon></template>
                    </v-list-item>
                </v-list-group>
                <v-list-item @click="showInstructions = true" prepend-icon="mdi-help-circle-outline" title="Help"></v-list-item>
                <v-list-item @click="showStatistics = true" prepend-icon="mdi-chart-bar" title="Statistics"></v-list-item>
                <v-list-group value="Scenes">
                    <template v-slot:activator="{ props }">
                        <v-list-item
                            v-bind="props" @click.stop
                            prepend-icon="mdi-folder-multiple-image"
                            title="选择场景"
                        ></v-list-item>
                    </template>
                    <v-list-item
                        v-for="sceneName in cloudSceneFiles"
                        :key="sceneName"
                        :title="sceneName"
                        @click="loadScene(sceneName)"
                    ></v-list-item>
                </v-list-group>
            </v-list>
        </v-menu>
        
        <!-- 主布局容器 -->
        <div class="main-layout">
            <!-- Canvas 容器，宽度由计算属性控制 -->
            <v-main class="canvas-container" :style="{ width: mainContentWidth }">
                <!-- canvas -->
                <canvas id="drop-zone"></canvas>
                <!-- FPS 计数器，由 v-if 控制显示 -->
                <div v-if="showFPS" class="fps-counter">
                    FPS: {{ Math.round(currentFPS) }}
                </div>
                <!-- pointerLock Controls 的遮罩层 -->
                <div id="blocker" ref="blocker" v-show="controlMode === 'pointerLock'">
                    <div id="instructions" @click="lockPointer">
                        <p style="font-size: 36px">点击以开始</p>
                        <p>
                            W, A, S, D = 移动<br/>
                            鼠标 = 环顾四周<br/>
                            ESC = 解锁鼠标
                        </p>
                    </div>
                </div>
                <!-- 统计信息面板 -->
                <div v-if="showStatistics" class="statistics-panel">
                    <v-card class="dialog-card" rounded="lg">
                         <v-card-title class="text-h5 font-weight-bold pa-4">统计信息</v-card-title>
                         <v-card-text class="pa-4">
                             <v-row>
                                 <!-- 第一列 -->
                                 <v-col cols="12" md="6">
                                     <v-list bg-color="transparent" class="stat-list">
                                         <v-list-item><v-row no-gutters align="center"><v-col>帧率 (FPS)</v-col><v-col class="text-grey-lighten-1 text-right">{{ Math.round(statistics.fps) }}</v-col></v-row></v-list-item>
                                         <v-list-item><v-row no-gutters align="center"><v-col>帧时间 (Frame Time)</v-col><v-col class="text-grey-lighten-1 text-right">{{ statistics.frameTime }} ms</v-col></v-row></v-list-item>
                                         <v-list-item><v-row no-gutters align="center"><v-col>Splat 数量</v-col><v-col class="text-grey-lighten-1 text-right">{{ statistics.splatNum }}</v-col></v-row></v-list-item>
                                     </v-list>
                                 </v-col>
                                 <!-- 第二列 -->
                                 <v-col cols="12" md="6">
                                     <v-list bg-color="transparent" class="stat-list">
                                         <v-list-item><v-row no-gutters align="center"><v-col>上次排序耗时 (Sort Time)</v-col><v-col class="text-grey-lighten-1 text-right">{{ statistics.lastSortTime }} ms</v-col></v-row></v-list-item>
                                         <v-list-item><v-row no-gutters align="center"><v-col>分辨率</v-col><v-col class="text-grey-lighten-1 text-right">{{ statistics.width }} x {{ statistics.height }}</v-col></v-row></v-list-item>
                                         <v-list-item><v-row no-gutters align="center"><v-col>DPR</v-col><v-col class="text-grey-lighten-1 text-right">{{ statistics.dpr }}</v-col></v-row></v-list-item>
                                     </v-list>
                                 </v-col>
                             </v-row>
                         </v-card-text>
                         <v-card-actions class="pa-4">
                             <v-spacer></v-spacer>
                             <v-btn variant="tonal" @click="showStatistics = false">关闭</v-btn>
                         </v-card-actions>
                    </v-card>
                </div>
            </v-main>

            <!-- 分隔条 -->
            <div v-if="sceneManager" class="splitter" @mousedown="startResize"></div>

            <!-- 右侧场景管理面板，通过 v-if 控制显示/隐藏 -->
            <v-sheet v-if="sceneManager" :style="{ width: panelWidth + 'px' }" class="scene-panel">
                <div class="d-flex pa-4 align-center">
                    <div class="text-h6 flex-grow-1">场景管理</div>
                    <v-btn
                        icon="mdi-close"
                        variant="text"
                        @click="sceneManager = false"
                    ></v-btn>
                </div>
                <v-divider></v-divider>
                <!-- 将列表包裹在一个带边框和内边距的div中 -->
                <div class="scrollable-list-container">
                    <v-list selectable class="scrollable-list">
                        <v-list-item v-if="sceneList.length === 0">
                            <v-list-item-title class="text-center text-grey">Scene list is empty</v-list-item-title>
                        </v-list-item>
                        <v-list-item
                            v-for="scene in sceneList"
                            :key="scene.uid"
                            :title="scene.name"
                            :active="scene.uid === selectedSceneUID"
                            @click="selectScene(scene.uid)"
                        >
                            <template v-slot:append>
                                <v-btn 
                                    icon="mdi-delete" 
                                    variant="text" 
                                    size="small"
                                    @click.stop="removeScene(scene.uid)"
                                ></v-btn>
                            </template>
                        </v-list-item>
                    </v-list>
                </div>
                
                <!-- 变换面板 -->
                <div v-if="selectedSceneTransform" class="transform-panel pa-2">
                    <div class="text-subtitle-1 mb-2">Transform</div>
                    
                    <v-row no-gutters align="center" class="mb-1">
                        <v-col cols="3" class="transform-row-label">Position</v-col>
                        <v-col v-for="axis in ['x', 'y', 'z']" :key="'pos-' + axis" class="pa-1">
                            <v-text-field 
                                v-model.number="selectedSceneTransform.position[axis]"
                                density="compact" hide-details variant="outlined"
                            >
                                <template v-slot:prepend-inner>
                                    <span class="draggable-label" @mousedown="startDrag($event, 'position', axis)">{{ axis.toUpperCase() }}</span>
                                </template>
                            </v-text-field>
                        </v-col>
                    </v-row>
                    
                    <v-row no-gutters align="center" class="mb-1">
                        <v-col cols="3" class="transform-row-label">Rotation</v-col>
                        <v-col v-for="axis in ['x', 'y', 'z']" :key="'rot-' + axis" class="pa-1">
                            <v-text-field 
                                v-model.number="selectedSceneTransform.rotation[axis]"
                                density="compact" hide-details variant="outlined"
                            >
                                <template v-slot:prepend-inner>
                                    <span class="draggable-label" @mousedown="startDrag($event, 'rotation', axis)">{{ axis.toUpperCase() }}</span>
                                </template>
                            </v-text-field>
                        </v-col>
                    </v-row>

                    <v-row no-gutters align="center" class="mb-1">
                        <v-col cols="3" class="transform-row-label">Scale</v-col>
                        <v-col v-for="axis in ['x', 'y', 'z']" :key="'scl-' + axis" class="pa-1">
                            <v-text-field 
                                v-model.number="selectedSceneTransform.scale[axis]"
                                density="compact" hide-details variant="outlined"
                            >
                                <template v-slot:prepend-inner>
                                    <span class="draggable-label" @mousedown="startDrag($event, 'scale', axis)">{{ axis.toUpperCase() }}</span>
                                </template>
                            </v-text-field>
                        </v-col>
                    </v-row>
                </div>
                <div v-else class="pa-4 text-center text-grey">
                    Select a scene to edit its properties
                </div>
            </v-sheet>
        </div>

        <!-- 隐藏的文件输入框 -->
        <input type="file" ref="fileInput" @change="onFileSelected" style="display: none;" />
        <!-- 操作说明 Dialog -->
        <v-dialog v-model="showInstructions" location="bottom" max-width="900px" class="ma-4">
            <v-card class="instructions-card" rounded="lg">
                <v-card-title class="text-h5 font-weight-bold pa-4">操作说明</v-card-title>
                <v-card-text class="pa-4">
                    <!-- PC端说明 -->
                    <div v-if="!isMobile">
                        <v-list-subheader>轨道控制 (Orbit)</v-list-subheader>
                        <v-list-item><v-row align="center"><v-col cols="5">旋转视角</v-col><v-col cols="7" class="text-grey-lighten-1">按住鼠标左键并拖动</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">缩放</v-col><v-col cols="7" class="text-grey-lighten-1">滚动鼠标滚轮</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">平移</v-col><v-col cols="7" class="text-grey-lighten-1">按住鼠标右键并拖动</v-col></v-row></v-list-item>
                        <v-divider class="my-2"></v-divider>
                        <v-list-subheader>第一人称 (PointerLock)</v-list-subheader>
                        <v-list-item><v-row align="center"><v-col cols="5">转动视角</v-col><v-col cols="7" class="text-grey-lighten-1">移动鼠标</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">移动</v-col><v-col cols="7" class="text-grey-lighten-1">W / A / S / D</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">退出模式</v-col><v-col cols="7" class="text-grey-lighten-1">ESC</v-col></v-row></v-list-item>
                        <v-divider class="my-2"></v-divider>
                        <v-list-subheader>飞行模式 (Fly)</v-list-subheader>
                        <v-list-item><v-row align="center"><v-col cols="5">调整方向</v-col><v-col cols="7" class="text-grey-lighten-1">按住鼠标左键并拖动</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">前进/后退</v-col><v-col cols="7" class="text-grey-lighten-1">W / S</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">左右平移</v-col><v-col cols="7" class="text-grey-lighten-1">A / D</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">上下平移</v-col><v-col cols="7" class="text-grey-lighten-1">R / F</v-col></v-row></v-list-item>
                    </div>
                    
                    <!-- 移动端说明 -->
                    <div v-else>
                        <v-list-subheader>轨道控制 (Orbit)</v-list-subheader>
                        <v-list-item><v-row align="center"><v-col cols="5">旋转视角</v-col><v-col cols="7" class="text-grey-lighten-1">单指拖动</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">缩放</v-col><v-col cols="7" class="text-grey-lighten-1">双指捏合/张开</v-col></v-row></v-list-item>
                        <v-list-item><v-row align="center"><v-col cols="5">平移</v-col><v-col cols="7" class="text-grey-lighten-1">双指拖动</v-col></v-row></v-list-item>
                    </div>
                </v-card-text>
                 <v-card-actions class="pa-4">
                    <v-spacer></v-spacer>
                    <v-btn variant="tonal" @click="showInstructions = false">关闭</v-btn>
                </v-card-actions>
            </v-card>
        </v-dialog>
        <!-- 状态通知条 -->
        <v-snackbar v-model="snackbar.show" :timeout="4000" location="bottom right">
            {{ snackbar.text }}
            <template v-slot:actions>
                <v-btn color="blue" variant="text" @click="snackbar.show = false">
                    关闭
                </v-btn>
            </template>
        </v-snackbar>
    </v-app>
</div>

<!-- Vue and Vuetify JS -->
<script src="https://cdn.jsdelivr.net/npm/vue@3.x/dist/vue.global.prod.js"></script>
<script src="https://cdn.jsdelivr.net/npm/vuetify@3.x/dist/vuetify.min.js"></script>
<script type="importmap">
    {
        "imports": {
            "three": "/node_modules/three/build/three.module.js",
            "@tweenjs/tween.js": "/node_modules/@tweenjs/tween.js/dist/tween.esm.js"
        }
    }
</script>
<script type="module">
    import ImmerScapeViewer from "./src/GSViewer.js";
    const { createApp, ref, onMounted, nextTick, computed, watch, reactive } = Vue;
    const { createVuetify } = Vuetify;

    const vuetify = createVuetify();

    createApp({
        setup() {
            let viewer;
            // this
            const isMobile = ref(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent));
            const menu = ref(false);

            const sceneManager = ref(false);
            const toggleSceneManager = () => {
                sceneManager.value = !sceneManager.value;
            };
            const panelWidth = ref(400);
            const mainContentWidth = computed(() => {
                return sceneManager.value ? `calc(100% - ${panelWidth.value}px)` : '100%';
            });
            const onResize = (event) => {
                const newWidth = window.innerWidth - event.clientX;
                panelWidth.value = Math.max(300, Math.min(800, newWidth));
            };
            const stopResize = () => {
                window.removeEventListener('mousemove', onResize);
                window.removeEventListener('mouseup', stopResize);
            };
            const startResize = (event) => {
                event.preventDefault();
                window.addEventListener('mousemove', onResize);
                window.addEventListener('mouseup', stopResize);
            };

            const showFPS = ref(false);
            const currentFPS = ref(0);
            const toggleFPS = () => {
                showFPS.value = !showFPS.value;
            };

            const fileInput = ref(null);
            const onFileSelected = (event) => {
                const file = event.target.files[0];
                if (!file) return;
                if (viewer) {
                    viewer.fetchSceneWithNative(file);
                }
            };
            const toggleImport = () => {
                fileInput.value.click();
            };

            const controlMode = ref('orbit');
            const toggleControls = (expectMode) => {
                if (viewer && viewer.setControlMode(expectMode)) {
                    controlMode.value = expectMode;
                }
            };
            const lockPointer = () => {
                if (viewer) {
                    viewer.lockPointer();
                }
            };

            const showInstructions = ref(false);

            const showStatistics = ref(false);
            const statistics = reactive({
                fps: 0,
                frameTime: 0,
                splatNum: 0,
                lastSortTime: 0,
                width: 0,
                height: 0,
                dpr: 0,
            });

            const cloudSceneFiles = [
                'chair', 'fit409', 'train',
                'flame', 'kitchen', 'girl1_60',
            ];
            const loadScene = (sceneName) => {
                if (viewer) {
                    viewer.fetchSceneWithURL(`/scenes/${sceneName}.spb`);
                }
            };

            const sceneList = ref([]);
            const removeScene = (sceneId) => {
                sceneList.value = sceneList.value.filter(scene => scene.uid !== sceneId);
                if (viewer) {
                    viewer.removeScene(sceneId);
                }
            };
            const snackbar = reactive({
                show: false,
                text: '',
            });
            const selectedSceneUID = ref('');
            const selectScene = (uid) => {
                selectedSceneUID.value = uid;
                if (viewer) {
                    viewer.switchToScene(uid);
                }
            };

            const selectedSceneTransform = computed(() => {
                if (selectedSceneUID.value === null) return null;
                const scene = sceneList.value.find(s => s.uid === selectedSceneUID.value);
                return scene ? scene.transform : null;
            });
            const dragState = reactive({
                active: false,
                property: null,
                axis: null,
                startX: 0,
                initialValue: 0,
            });
            const startDrag = (event, property, axis) => {
                if (!selectedSceneTransform.value) return;
                event.preventDefault();
                dragState.active = true;
                dragState.property = property;
                dragState.axis = axis;
                dragState.startX = event.clientX;
                dragState.initialValue = selectedSceneTransform.value[property][axis];
                
                window.addEventListener('mousemove', onDrag);
                window.addEventListener('mouseup', stopDrag);
            };
            const onDrag = (event) => {
                if (!dragState.active) return;
                const deltaX = event.clientX - dragState.startX;
                let sensitivity = 0.1;
                if (dragState.property === 'scale') {
                    sensitivity = 0.01;
                    dragState.axis = 'x';
                }
                if (dragState.property === 'rotation') sensitivity = 0.5;

                const newValue = dragState.initialValue + deltaX * sensitivity;
                selectedSceneTransform.value[dragState.property][dragState.axis] = parseFloat(newValue.toFixed(2));
                if (dragState.property === 'scale') {
                    selectedSceneTransform.value[dragState.property].y = selectedSceneTransform.value[dragState.property].x;
                    selectedSceneTransform.value[dragState.property].z = selectedSceneTransform.value[dragState.property].x;
                }
            };
            const stopDrag = () => {
                dragState.active = false;
                window.removeEventListener('mousemove', onDrag);
                window.removeEventListener('mouseup', stopDrag);
            };
            watch(selectedSceneTransform, (newValue) => {
                if (viewer && newValue) {
                    viewer.updateTransform();
                }
            }, { deep: true });

            onMounted(() => {
                console.log(document.getElementById('drop-zone'))
                viewer = new ImmerScapeViewer();
                viewer.run();
                viewer.fetchSceneWithURL("/test/chair.glb");
                viewer.addExternalListener((msg) => {
                    if (msg.sceneLoaded) {
                        const exists = sceneList.value.some(scene => scene.uid === msg.uid);
                        if (!exists) {
                            sceneList.value.push({
                                uid: msg.uid,
                                name: msg.name,
                                transform: msg.transform,
                            });
                        }
                        snackbar.show = false;
                        selectedSceneUID.value = msg.uid;
                    } else if (msg.startLoad) {
                        snackbar.text = 'start to load...';
                        snackbar.show = true;
                    } else if (msg.failLoad) {
                        snackbar.text = `fail to load: ${msg.error}`;
                        snackbar.show = true;
                    }
                })

                setInterval(() => {
                    if (viewer) {
                        currentFPS.value = viewer.getFPS ? viewer.getFPS() : 0;
                        statistics.fps = currentFPS.value;
                        statistics.frameTime = viewer.getFrameTime ? (viewer.getFrameTime() || 0).toFixed(2) : 'N/A';
                        statistics.splatNum = viewer.getSplatNum ? viewer.getSplatNum() : 'N/A';
                        statistics.lastSortTime = viewer.getLastSortTime ? (viewer.getLastSortTime() || 0).toFixed(2) : 'N/A';
                        const resolution = viewer.getResolution ? viewer.getResolution() : {width:0, height:0, dpr:0};
                        statistics.width = resolution.width;
                        statistics.height = resolution.height;
                        statistics.dpr = resolution.dpr;
                    }
                }, 1000);
                
            });

            return {
                isMobile, menu,
                sceneManager, panelWidth, mainContentWidth, toggleSceneManager, onResize, startResize, stopResize, 
                showFPS, currentFPS, toggleFPS,
                fileInput, onFileSelected, toggleImport,
                controlMode, toggleControls, lockPointer,
                showInstructions,
                showStatistics, statistics,
                cloudSceneFiles, loadScene,
                sceneList, removeScene, snackbar, selectedSceneUID, selectScene, 
                selectedSceneTransform, dragState, startDrag, onDrag, stopDrag, 
            };
        }
    }).use(vuetify).mount('#app');
</script>

</body>
</html>
